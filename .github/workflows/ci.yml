name: CI/Quality Check

on:
  workflow_run:
    workflows:
      - "Service/Create Release PR"
    types:
      - completed
  pull_request:
    types:
      - opened
  push:
    branches:
      - release/feat/**
      - release/fix/**
      - feat/**
      - fix/**

jobs:
  CI-Quality-Gate:
    runs-on:
      - ubuntu-latest

    permissions:
      security-events: write

    steps:
      - uses: actions/checkout@v3
        with:
          persist-credentials: false
      - name: ðŸ¤– Yarn install
        uses: ./.github/actions/yarn-install
        with:
          GITHUB_TOKEN: ${{secrets.CI_TOKEN}}
      - name: ðŸš¦ Qualtiy Gate
        uses: ./.github/actions/quality
      - name: Trigger status event
        run: >-
          curl -L -X POST 
          -H "Content-Type: application/json"
          -H "Authorization: token ${{ secrets.GITHCI_TOOKENUB_PAT}}"
          -d '{
            "state": "success",
            "description": "Quality Gate Passed", "context": "native-base-components/ci-success"
          }'
          "https://api.github.com/repos/${GITHUB_REPOSITORY}/statuses/${GITHUB_SHA}"
